<!DOCTYPE html>
<html>
    <body>
        <div>
            <textarea id="puzzleInput" rows="10" cols="150"></textarea>
            <button onclick="solveClick()">solve</button>
        </div>
        <div>
            <p id="solutionOutput"></p>
        </div>

        <script>
            var matrix = [];
            function solveClick() {
                var text = document.getElementById('puzzleInput').value.trim();
                var rows = text.split("\n");
                var sum = 0;

                rows.forEach(row => {
                    var matrixRow = [];
                    row = row.split("");
                    row.forEach((col) => {
                        matrixRow.push(col);
                    });
                    matrix.push(matrixRow);
                });

                console.log(matrix);

                matrix.forEach((row, rowindex) => {
                    var skip = 0;
                    row.forEach((col, colindex) => {

                        if(skip > 0) {
                            skip--;
                        }
                        else {
                            if(/[0-9]/g.test(col)) {
                                var number = col;
                                var offset = 1;
                                while(/[0-9]/g.test(matrix[rowindex][colindex+offset])) {
                                    number += matrix[rowindex][colindex+offset];
                                    offset++;
                                    skip++;
                                }
                                //console.log(number);
                                if(isPartNumber(rowindex, colindex, offset)) {
                                    console.log("add " + number);
                                    sum += parseInt(number);
                                }
                            }
                        }

                   });
                });

                var outputElement = document.getElementById('solutionOutput');
                outputElement.innerHTML = sum;
            }

            function isPartNumber(row, colFirst, numberOfDigits) {

                //check left
                if(colFirst > 0 ) {
                    if(matrix[row][colFirst-1] !== 'undefined' && matrix[row][colFirst-1] !== "." && !(/[0-9]/g.test(matrix[row][colFirst-1]))) {
                        console.log("left");
                        return true;
                    }
                }

                //check right
                if(matrix[row][colFirst+numberOfDigits] !== 'undefined' && matrix[row][colFirst+numberOfDigits] !== "." && !(/[0-9]/g.test(matrix[row][colFirst+numberOfDigits]))) {
                    console.log("right");
                    return true;
                }

                //check above
                if(row > 0) {
                    var i = 0;
                    while(i < numberOfDigits) {
                        if(matrix[row-1][colFirst+i] !== 'undefined' && matrix[row-1][colFirst+i] !== '.' && !(/[0-9]/g.test(matrix[row-1][colFirst+i])) ) {
                            console.log("above");
                            return true;
                        }
                        i++;
                    }
                    
                    //check diagonal corners
                    //top left
                    if(matrix[row-1][colFirst-1] !== 'undefined' && matrix[row-1][colFirst-1] !== '.' && !(/[0-9]/g.test(matrix[row-1][colFirst-1])) ) {
                        console.log("top-left");
                        return true;
                    }
                    //top right
                    if(matrix[row-1][colFirst+numberOfDigits] !== 'undefined' && matrix[row-1][colFirst+numberOfDigits] !== '.' && !(/[0-9]/g.test(matrix[row-1][colFirst+numberOfDigits])) ) {
                        console.log("top-right");
                        return true;
                    }
                }

                //check below
                if(row < matrix.length-1) {
                    console.log("row is: " + row + " length is: " + matrix.length);
                    var i = 0;
                    while(i < numberOfDigits) {
                        if(matrix[row+1][colFirst+i] !== 'undefined' && matrix[row+1][colFirst+i] !== '.' && !(/[0-9]/g.test(matrix[row+1][colFirst+i])) ) {
                            console.log("below");
                            return true;
                        }
                        i++;
                    }
                    //check diagonal corners
                    //top left
                    if(matrix[row+1][colFirst-1] !== 'undefined' && matrix[row+1][colFirst-1] !== '.' && !(/[0-9]/g.test(matrix[row+1][colFirst-1])) ) {
                        console.log("bottom-left");
                        return true;

                    }
                    //top right
                    if(matrix[row+1][colFirst+numberOfDigits] !== 'undefined' && matrix[row+1][colFirst+numberOfDigits] !== '.' && !(/[0-9]/g.test(matrix[row+1][colFirst+numberOfDigits])) ) {
                        console.log("bottom-right");
                        return true;
                    }

                }



                return false;
            }
        </script>
    </body>
</html>